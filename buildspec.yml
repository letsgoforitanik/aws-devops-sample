version: 0.2

phases:
    build:
        commands:
            - echo "Building docker Image"
            - docker build -t fibo-stress .
            - docker tag fibo-stress:latest $IMAGE_REGISTRY/fibo-stress:$CODEBUILD_BUILD_NUMBER
            - echo "Authenticating to AWS ECR"
            - docker login -u "$REGISTRY_USERNAME" -p "$REGISTRY_PASSWORD" $IMAGE_REGISTRY
            - echo "Pushing Image"
            - docker push $IMAGE_REGISTRY/fibo-stress:$CODEBUILD_BUILD_NUMBER
            - echo "Build successfully completed"
